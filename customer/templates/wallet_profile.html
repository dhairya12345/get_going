{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Going System | Wallet & Profile</title>
    <link rel="stylesheet" href="{% static 'css/wallet_profile.css'%}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <a href="user_home.html" class="logo">GET GOING</a>
            <div class="nav-links">
                <a href="user_home.html"><i class="fas fa-home"></i> Home</a>
                <a href="available_rides.html"><i class="fas fa-car"></i> Available Rides</a>
                <a href="ride_history.html"><i class="fas fa-history"></i> Ride History</a>
                <a href="wallet_profile.html" class="active"><i class="fas fa-wallet"></i> Wallet</a>
                <div class="dropdown">
                    <button class="dropbtn">
                        <i class="fas fa-user-circle"></i> Profile <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="#"><i class="fas fa-user"></i> My Account</a>
                        <a href="#"><i class="fas fa-cog"></i> Settings</a>
                        <a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
            <div class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="wallet-profile-page">
        <div class="container">
            <div class="page-header">
                <h1>Wallet & Profile</h1>
                <p>Manage your account and wallet balance</p>
            </div>

            <div class="content-grid">
                <!-- Profile Section -->
                <section class="profile-section">
                    <div class="section-header">
                        <h2><i class="fas fa-user"></i> Profile Details</h2>
                        <button class="btn-outline edit-profile-btn">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                    </div>
                    
                    <div class="profile-card">
                        <zdiv class="profile-picture">
                            <img src="{% static user.profile_img %}" alt="Profile Picture" id="profile-pic">
                            <input type="file" id="uploadfile">
                            <button onclick="uploadFile()" >
                             upload
                            </button>
                            
                        </div>
                        
                        <div class="profile-details">
                            <div class="detail-row">
                                <span class="detail-label">Full Name:</span>
                                <span class="detail-value" >{{ user.name }}</span>

                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Email:</span>
                                <span class="detail-value" id="user-email">{{ user.email }}</span>

                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Phone:</span>
                                <span class="detail-value" id="user-phone">{{ user.phone }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Member Since:</span>
                                <span class="detail-value">15 Jan 2023</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Total Rides:</span>
                                <span class="detail-value">24</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Average Rating:</span>
                                <span class="detail-value">
                                    <i class="fas fa-star"></i> 4.7 (32 reviews)
                                </span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Wallet Section -->
                <section class="wallet-section">
                    <div class="section-header">
                        <h2><i class="fas fa-wallet"></i> Wallet Balance</h2>
                    </div>
                    
                    <div class="wallet-card">
                        <div class="wallet-balance">
                            <h3>Available Balance</h3>
                            <div class="balance-amount">₹1,850</div>
                        </div>
                        
                        <div class="wallet-actions">
                            <button class="btn-primary add-money-btn">
                                <i class="fas fa-plus-circle"></i> Add Money
                            </button>
                            <button class="btn-outline withdraw-money-btn">
                                <i class="fas fa-rupee-sign"></i> Withdraw
                            </button>
                        </div>
                    </div>
                    
                    <div class="transactions-section">
                        <div class="section-header">
                            <h3>Recent Transactions</h3>
                            <a href="#" class="view-all-link">View All</a>
                        </div>
                        
                        <div class="transactions-list">
                            <div class="transaction-item">
                                <div class="transaction-icon">
                                    <i class="fas fa-arrow-down success"></i>
                                </div>
                                <div class="transaction-details">
                                    <div class="transaction-title">Added to Wallet</div>
                                    <div class="transaction-date">Today, 10:45 AM</div>
                                </div>
                                <div class="transaction-amount success">+ ₹500</div>
                            </div>
                            
                            <div class="transaction-item">
                                <div class="transaction-icon">
                                    <i class="fas fa-arrow-up danger"></i>
                                </div>
                                <div class="transaction-details">
                                    <div class="transaction-title">Ride Payment</div>
                                    <div class="transaction-date">Yesterday, 5:30 PM</div>
                                </div>
                                <div class="transaction-amount danger">- ₹180</div>
                            </div>
                            
                            <div class="transaction-item">
                                <div class="transaction-icon">
                                    <i class="fas fa-arrow-down success"></i>
                                </div>
                                <div class="transaction-details">
                                    <div class="transaction-title">Referral Bonus</div>
                                    <div class="transaction-date">15 Mar 2023</div>
                                </div>
                                <div class="transaction-amount success">+ ₹200</div>
                            </div>
                            
                            <div class="transaction-item">
                                <div class="transaction-icon">
                                    <i class="fas fa-arrow-up danger"></i>
                                </div>
                                <div class="transaction-details">
                                    <div class="transaction-title">Ride Payment</div>
                                    <div class="transaction-date">12 Mar 2023</div>
                                </div>
                                <div class="transaction-amount danger">- ₹150</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>GET GOING</h3>
                    <p>Ride-sharing made simple, affordable, and eco-friendly.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="user_home.html">Home</a></li>
                        <li><a href="available_rides.html">Available Rides</a></li>
                        <li><a href="ride_history.html">Ride History</a></li>
                        <li><a href="wallet_profile.html">Wallet</a></li>
                        <li><a href="#">Profile</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Safety</a></li>
                        <li><a href="#">Community Guidelines</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Download App</h3>
                    <div class="app-download">
                        <a href="#" class="app-btn">
                            <i class="fab fa-google-play"></i>
                            <span>GET IT ON<br><strong>Google Play</strong></span>
                        </a>
                        <a href="#" class="app-btn">
                            <i class="fab fa-apple"></i>
                            <span>Download on the<br><strong>App Store</strong></span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Get Going System. All rights reserved.</p>
                <div class="footer-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Add Money Modal -->
    <div class="modal" id="add-money-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <h2>Add Money to Wallet</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="amount">Amount (₹)</label>
                    <input type="number" id="amount" placeholder="Enter amount" min="100" step="100">
                </div>
                <div class="payment-methods">
                    <h3>Payment Method</h3>
                    <div class="payment-options">
                        <label class="payment-option">
                            <input type="radio" name="payment-method" value="upi" checked>
                            <span class="radio-btn"></span>
                            <i class="fas fa-mobile-alt"></i> UPI
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="payment-method" value="card">
                            <span class="radio-btn"></span>
                            <i class="far fa-credit-card"></i> Credit/Debit Card
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="payment-method" value="netbanking">
                            <span class="radio-btn"></span>
                            <i class="fas fa-university"></i> Net Banking
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-outline" id="cancel-add-money">Cancel</button>
                <button class="btn-primary" id="confirm-add-money">Add Money</button>
            </div>
        </div>
    </div>

    <!-- Withdraw Money Modal -->
    <div class="modal" id="withdraw-money-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <h2>Withdraw Money</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="withdraw-amount">Amount (₹)</label>
                    <input type="number" id="withdraw-amount" placeholder="Enter amount" min="100" step="100">
                </div>
                <div class="form-group">
                    <label for="bank-account">Bank Account</label>
                    <select id="bank-account">
                        <option value="">Select Bank Account</option>
                        <option value="1">HDFC Bank ****4532</option>
                        <option value="2">SBI Bank ****7890</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="account-holder">Account Holder Name</label>
                    <input type="text" id="account-holder" placeholder="Enter account holder name">
                </div>
                <div class="form-group">
                    <label for="ifsc-code">IFSC Code</label>
                    <input type="text" id="ifsc-code" placeholder="Enter IFSC code">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-outline" id="cancel-withdraw">Cancel</button>
                <button class="btn-primary" id="confirm-withdraw">Withdraw</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="edit-profile-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <h2>Edit Profile</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-name">Full Name</label>
                    <input name="name" type="text" id="edit-name" placeholder="Enter your full name" value={{ user.name }}>
                </div>
                <div class="form-group">
                    <label for="edit-email">Email</label>
                    <input name="email" type="email" id="edit-email" placeholder="Enter your email" value = {{ user.email }}>
                </div>
                <div class="form-group">
                    <label for="edit-phone">Phone Number</label>
                    <input name="phone" type="tel" id="edit-phone" placeholder="Enter your phone number" value= {{ user.phone }}>
                </div>
                <div class="form-group">
                    <label for="edit-password">Change Password</label>
                    <input type="password" id="edit-password" placeholder="Enter new password">
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirm Password</label>
                    <input type="password" id="confirm-password" placeholder="Confirm new password">
                </div> 
            </div>
            <div class="modal-footer">
                <button class="btn-outline" id="cancel-edit-profile">Cancel</button>
                <button  name="form_btn" class="btn-primary" id="save-profile" onclick="uploadform()">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="{%static 'js/wallet_profile.js'%}"></script>

</body>
<script>
    function uploadFile(){
        const input = document.getElementById("uploadfile");
        const file = input.files[0];
        const formData = new FormData();
        formData.append('file',file);
    
        fetch('/customer/login/user_home1/profile',{
            method: 'POST',
            body : formData,
            headers: {
                'X-CSRFToken' : getCSRFToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log("upload success",data);
            if(data.status === 'ok')
            {
                location.reload();
            }
        })
        .catch(error=>{
            console.error("Error: ",error);
        });
    }
    function getCSRFToken() {
        return document.cookie.split('; ')
            .find(row => row.startsWith('csrftoken'))
            ?.split('=')[1];
    }
    function uploadform(){
        const data = new URLSearchParams();
        data.append('name',document.getElementById('edit-name').value)
        data.append('email',document.getElementById('edit-email').value)
        data.append('phone',document.getElementById('edit-phone').value)
        data.append('password',document.getElementById('edit-password').value)
        fetch('/customer/login/user_home1/profile',{
            method:'POST',
            headers:{
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': getCSRFToken()
            },
            body: data
        })
        .then(response => response.json())
        .then(data=>{
            console.log('Success: ',data);
            alert("data updated")
            if(data.status === 'ok')
            {
                location.reload();
            }
        }).catch(error =>{
            alert("data not updated")
        })
    }
    {% comment %} fetch('/customer/login/user_home1/profile',{
        method: 'POST',
        headers:{
            'X-CSRFToken' : '{{ csrf_token }}'
        },
        body: new URLSearchParams({
            'key':'value'
        })
    }).then(response=>response.json())
    .then(data=>{
        if(data.status === 'ok'){
            location.reload();
        }
    }); {% endcomment %}

</script>
</html>